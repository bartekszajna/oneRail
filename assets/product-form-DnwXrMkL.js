import{S as O,h as w,i as v,k as F,n as j,l as E,r as h,m as I,o as K,p as M,j as n,a as R,q as b}from"./index-BIWb99zH.js";import{b as y,c as N,z as l,S as P,B as T,u as k,a as q,F as L,T as x}from"./zod-CGfnChNc.js";import{i as U}from"./isValidURL-CXYh_dqB.js";import{c as D}from"./createLucideIcon-C9YSeJfB.js";var Q=class extends O{#e;#i=void 0;#t;#s;constructor(t,e){super(),this.#e=t,this.setOptions(e),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const e=this.options;this.options=this.#e.defaultMutationOptions(t),w(this.options,e)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#t,observer:this}),e?.mutationKey&&this.options.mutationKey&&v(e.mutationKey)!==v(this.options.mutationKey)?this.reset():this.#t?.state.status==="pending"&&this.#t.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#t?.removeObserver(this)}onMutationUpdate(t){this.#r(),this.#n(t)}getCurrentResult(){return this.#i}reset(){this.#t?.removeObserver(this),this.#t=void 0,this.#r(),this.#n()}mutate(t,e){return this.#s=e,this.#t?.removeObserver(this),this.#t=this.#e.getMutationCache().build(this.#e,this.options),this.#t.addObserver(this),this.#t.execute(t)}#r(){const t=this.#t?.state??F();this.#i={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#n(t){j.batch(()=>{if(this.#s&&this.hasListeners()){const e=this.#i.variables,r=this.#i.context,s={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};t?.type==="success"?(this.#s.onSuccess?.(t.data,e,r,s),this.#s.onSettled?.(t.data,null,e,r,s)):t?.type==="error"&&(this.#s.onError?.(t.error,e,r,s),this.#s.onSettled?.(void 0,t.error,e,r,s))}this.listeners.forEach(e=>{e(this.#i)})})}};function S(t,e){const r=E(),[s]=h.useState(()=>new Q(r,t));h.useEffect(()=>{s.setOptions(t)},[s,t]);const i=h.useSyncExternalStore(h.useCallback(o=>s.subscribe(j.batchCalls(o)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),u=h.useCallback((o,d)=>{s.mutate(o,d).catch(I)},[s]);if(i.error&&K(s.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:u,mutateAsync:i.mutate}}async function V(t){return(await M.post("/products/",t)).data}const A=async(t,e)=>(await M.put("/products/"+t,e)).data;/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],H=D("trash",z);function _({name:t,control:e,...r}){const{field:s,fieldState:i}=y({name:t,control:e});return n.jsx(N,{...s,className:"resize-none",...r,error:i.error?.message})}const B=l.object({title:l.string().min(1,{error:"Field cannot be empty"}),description:l.string().min(1,{error:"Field cannot be empty"}),price:l.coerce.number().int().min(1).max(9999),categoryId:l.number().int().min(1),images:l.array(l.string()).superRefine((t,e)=>{(t.filter(s=>!U(s)).length>0||!t.length)&&e.addIssue({code:"custom",message:"One or more valid URLs is required",path:[]})})});function G({name:t,options:e,control:r,...s}){const{field:i,fieldState:u}=y({name:t,control:r});return n.jsx(P,{options:e,...i,...s,error:u.error?.message})}function J({name:t,label:e,control:r,...s}){const[i,u]=h.useState(""),{field:{value:o=[],onChange:d,...f},fieldState:p}=y({name:t,control:r}),g=()=>{const a=i.trim();a&&!o.includes(a)&&(d([...o,a]),u(""))},c=a=>{d(o.filter(C=>C!==a))},m=a=>{a.key==="Enter"&&(a.preventDefault(),g())};return n.jsxs("div",{children:[n.jsx(T,{...s,...f,value:i,onChange:a=>u(a.target.value),onKeyDown:m,label:e,error:p.error?.message}),n.jsx("h4",{children:"URLs list:"}),n.jsx("ul",{className:"mt-2",children:o?.map(a=>n.jsxs("li",{className:"w-full flex text-sm bg-[var(--light-bg)] rounded-full px-3 py-2 items-center justify-between gap-4 mb-4",children:[n.jsx("span",{className:"w-full truncate",children:a}),n.jsx("button",{type:"button",className:"hover:cursor-pointer hover:text-amber-500 ",onClick:()=>c(a),children:n.jsx(H,{className:"size-4"})})]},a))})]})}const W=t=>{const e=S({mutationFn:V,onSuccess:()=>{b.invalidateQueries({queryKey:["products"]})}}),r=S({mutationFn:({id:c,data:m})=>A(c,m),onSuccess:(c,m)=>{b.invalidateQueries({queryKey:["products"]}),b.invalidateQueries({queryKey:["products",m.id]})}}),{handleSubmit:s,setError:i,control:u,formState:{errors:o,isSubmitting:d}}=k({defaultValues:{title:t?.title||"",price:t?.price||1,categoryId:t?.categoryId||1,description:t?.description||"",images:t?.images||[]},resolver:q(B)}),f=async c=>{try{t?.id?r.mutate(t.id,c):await e.mutate(c),b.invalidateQueries()}catch{i("root",{message:t?.id?"The product could not be updated":"The product could not be created"})}},p=R(),g=p.state==="loading"||p.state==="submitting"||d;return{handleSubmit:s,submitHandler:f,control:u,isSubmitting:g,errors:o}},tt=({product:t,categories:e})=>{const{handleSubmit:r,submitHandler:s,control:i,isSubmitting:u,errors:o}=W(t);return n.jsxs(L,{onSubmit:r(s),isSubmitting:u,children:[n.jsx(x,{label:"Title",name:"title",control:i}),n.jsx(x,{label:"Price",name:"price",control:i}),n.jsx(_,{label:"Description",name:"description",control:i,rows:7}),n.jsx(G,{label:"Category",name:"categoryId",control:i,options:e}),n.jsx(J,{label:"Images",name:"images",control:i}),o.root&&n.jsx("span",{className:"text-red-600 font-semibold text-sm",children:o.root.message})]})};export{tt as P};
