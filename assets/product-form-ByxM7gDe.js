import{e as j,j as t,r as v,q as g,a as F}from"./index-DAiz0CAH.js";import{b as x,z as d,u as w,a as I,F as T,T as h}from"./zod-of8WfUDN.js";import{T as P,S as N,B as q}from"./select-input-D1r--hoW.js";import{T as C,u as y}from"./trash-CFemfFUP.js";import{i as M}from"./isValidURL-CXYh_dqB.js";async function R(e){return(await j.post("/products/",e)).data}const A=async(e,s)=>(await j.put("/products/"+e,s)).data;function K({name:e,control:s,...n}){const{field:a,fieldState:r}=x({name:e,control:s});return t.jsx(P,{...a,...n,error:r.error?.message})}function D({name:e,options:s,control:n,...a}){const{field:r,fieldState:c}=x({name:e,control:n}),o=v.useMemo(()=>s?.map(l=>({value:l.id,label:l.name})),[s]);return t.jsx(N,{options:o,...r,...a,error:c.error?.message})}function E({name:e,label:s,control:n,...a}){const[r,c]=v.useState(""),{field:{value:o=[],onChange:l,...b},fieldState:p}=x({name:e,control:n}),f=()=>{const i=r.trim();i&&!o.includes(i)&&(l([...o,i]),c(""))},u=i=>{l(o.filter(S=>S!==i))},m=i=>{i.key==="Enter"&&(i.preventDefault(),f())};return t.jsxs("div",{children:[t.jsx(q,{...a,...b,value:r,onChange:i=>c(i.target.value),onKeyDown:m,label:s,error:p.error?.message}),t.jsx("h4",{children:"URLs list:"}),t.jsx("ul",{className:"mt-2",children:o?.map(i=>t.jsxs("li",{className:"w-full flex text-sm bg-[var(--light-bg)] rounded-full px-3 py-2 items-center justify-between gap-4 mb-4",children:[t.jsx("span",{className:"w-full truncate",children:i}),t.jsx("button",{type:"button",className:"hover:cursor-pointer hover:text-amber-500 ",onClick:()=>u(i),children:t.jsx(C,{className:"size-4"})})]},i))})]})}const Q=d.object({title:d.string().min(1,{error:"Field cannot be empty"}),description:d.string().min(1,{error:"Field cannot be empty"}),price:d.coerce.number().int().min(1).max(9999),categoryId:d.coerce.number().int().min(1),images:d.array(d.string()).superRefine((e,s)=>{(e.filter(a=>!M(a)).length>0||!e.length)&&s.addIssue({code:"custom",message:"One or more valid URLs is required",path:[]})})}),L=e=>{const s=y({mutationFn:R,onSuccess:()=>{g.invalidateQueries({queryKey:["products"]})}}),n=y({mutationFn:({id:u,data:m})=>A(u,m),onSuccess:(u,m)=>{g.invalidateQueries({queryKey:["products"]}),g.invalidateQueries({queryKey:["products",m.id]})}}),{handleSubmit:a,setError:r,control:c,formState:{errors:o,isSubmitting:l}}=w({defaultValues:{title:e?.title||"",price:e?.price||1,categoryId:e?.categoryId||1,description:e?.description||"",images:e?.images||[]},resolver:I(Q)}),b=async u=>{try{e.id?await n.mutateAsync({id:e.id,data:u}):await s.mutateAsync(u),g.invalidateQueries()}catch{r("root",{message:e.id?"The product could not be updated":"The product could not be created"})}},p=F(),f=p.state==="loading"||p.state==="submitting"||l;return{handleSubmit:a,submitHandler:b,control:c,isSubmitting:f,errors:o}},H=({product:e,categories:s})=>{const{handleSubmit:n,submitHandler:a,control:r,isSubmitting:c,errors:o}=L(e);return t.jsxs(T,{onSubmit:n(a),isSubmitting:c,children:[t.jsx(h,{label:"Title",name:"title",control:r}),t.jsx(h,{label:"Price",name:"price",control:r}),t.jsx(K,{label:"Description",name:"description",control:r,rows:7}),t.jsx(D,{label:"Category",name:"categoryId",control:r,options:s}),t.jsx(E,{label:"Images",name:"images",control:r}),o.root&&t.jsx("span",{className:"text-red-600 font-semibold text-sm",children:o.root.message})]})};export{H as P};
