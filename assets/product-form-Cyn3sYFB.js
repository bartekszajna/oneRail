import{e as S,j as s,r as F,u as P,q as b,a as T,y,R as w}from"./index-B4Yr9dN7.js";import{b as x,z as u,u as I,a as R,F as N,T as j}from"./zod-7xlfzett.js";import{T as q,S as C,B as D}from"./select-input-BW3-13By.js";import{T as M,u as v}from"./trash-BcnNUkxM.js";import{i as A}from"./isValidURL-CXYh_dqB.js";async function E(e){return(await S.post("/products/",e)).data}const K=async(e,r)=>(await S.put("/products/"+e,r)).data;function U({name:e,control:r,...i}){const{field:n,fieldState:a}=x({name:e,control:r});return s.jsx(q,{...n,...i,error:a.error?.message})}function k({name:e,options:r,control:i,...n}){const{field:a,fieldState:c}=x({name:e,control:i}),o=F.useMemo(()=>r?.map(l=>({value:l.id,label:l.name})),[r]);return s.jsx(C,{options:o,...a,...n,error:c.error?.message})}function B({name:e,label:r,control:i,...n}){const[a,c]=F.useState(""),{field:{value:o=[],onChange:l,...g},fieldState:p}=x({name:e,control:i}),f=()=>{const t=a.trim();t&&!o.includes(t)&&(l([...o,t]),c(""))},m=t=>{l(o.filter(d=>d!==t))},h=t=>{t.key==="Enter"&&(t.preventDefault(),f())};return s.jsxs("div",{children:[s.jsx(D,{...n,...g,value:a,onChange:t=>c(t.target.value),onKeyDown:h,label:r,error:p.error?.message}),s.jsx("h4",{children:"URLs list:"}),s.jsx("ul",{className:"mt-2",children:o?.map(t=>s.jsxs("li",{className:"w-full flex text-sm bg-[var(--light-bg)] rounded-full px-3 py-2 items-center justify-between gap-4 mb-4",children:[s.jsx("span",{className:"w-full truncate",children:t}),s.jsx("button",{type:"button",className:"hover:cursor-pointer hover:text-amber-500 ",onClick:()=>m(t),children:s.jsx(M,{className:"size-4"})})]},t))})]})}const O=u.object({title:u.string().min(1,{error:"Field cannot be empty"}),description:u.string().min(1,{error:"Field cannot be empty"}),price:u.coerce.number().int().min(1).max(9999),categoryId:u.coerce.number().int().min(1),images:u.array(u.string()).superRefine((e,r)=>{(e.filter(n=>!A(n)).length>0||!e.length)&&r.addIssue({code:"custom",message:"One or more valid URLs is required",path:[]})})}),L=e=>{const r=P(),i=v({mutationFn:E,onSuccess:()=>{b.invalidateQueries({queryKey:["products"]})}}),n=v({mutationFn:({id:t,data:d})=>K(t,d),onSuccess:(t,d)=>{b.invalidateQueries({queryKey:["products"]}),b.invalidateQueries({queryKey:["products",d.id]})}}),{handleSubmit:a,setError:c,control:o,formState:{errors:l,isSubmitting:g,isDirty:p}}=I({defaultValues:{title:e?.title||"",price:e?.price||1,categoryId:e?.categoryId||1,description:e?.description||"",images:e?.images||[]},resolver:R(O)}),f=async t=>{if(!p){c("root",{message:"No changes to the form detected"});return}try{e?.id?await n.mutateAsync({id:e.id,data:t}):await i.mutateAsync(t),y.success(`Product ${e?.id?"edited":"created"} successfully.`,{theme:"dark",hideProgressBar:!0}),r(w.PRODUCTS)}catch{c("root",{message:e?.id?"The product could not be updated":"The product could not be created"}),y.error("Request unsuccessful. Please try again later.",{theme:"dark",hideProgressBar:!0})}},m=T(),h=m.state==="loading"||m.state==="submitting"||g;return{handleSubmit:a,submitHandler:f,control:o,isSubmitting:h,errors:l}},$=({product:e,categories:r})=>{const{handleSubmit:i,submitHandler:n,control:a,isSubmitting:c,errors:o}=L(e);return s.jsxs(N,{onSubmit:i(n),isSubmitting:c,children:[s.jsx(j,{label:"Title",name:"title",control:a}),s.jsx(j,{label:"Price",name:"price",control:a}),s.jsx(U,{label:"Description",name:"description",control:a,rows:7}),s.jsx(k,{label:"Category",name:"categoryId",control:a,options:r}),s.jsx(B,{label:"Images",name:"images",control:a}),o.root&&s.jsx("span",{className:"text-red-600 font-semibold text-sm",children:o.root.message})]})};export{$ as P};
